<!--
author: Justin
head: 
date: 2021-07-16
title: 任务派单系统设计
tags: hellobike
images: http://pingodata.qiniudn.com/cube2.jpg
category: hellobike
status: publish
summary: 任务派单系统设计
-->

## 背景概括

随着物联网设备分时租赁业务的发展，如何有效保证设备可用性是一个无法避免的话题。

对于两轮事业，主要的设备是车辆，车辆的生命周期如下图所示：

![](http://www.ranjia.online/blog/img/hellobike001.jpg)

当车辆由于故障、城管等原因变为“不可用车”后,运维人员通过维修、调度的方式，把车辆重新投放到市场，继续运营。

无论是通过自己的雇员维护保养，还是通过外包人员调度维修。都需要将相关信息有效的触达到执行人，同时能线上化跟踪维修、调度结果。

这一过程，我们称之为任务的派发、履约过程。而承载整个运营周期的线上化的系统就是我们的任务派单系统。

## 需求分析

很明显，从用户的角度来看，使用我们派单系统的人，主要有大概5个角色：

#### 运维人员

运维人员也是任务执行人员。主要使用的业务场景有：

* 查询我的任务列表
* 查看任务目的地，路线
* 查询任务详情
* 手动领取任务
* 任务履约
* 异常反馈
* 查询薪资明细
* 查询账户明细
* 账户提现
* 任务评价

#### 运维管理人员

运维管理人员是运营商下的管理人员，拥有比执行人更高的权限，可以看到管理区域的全部数据，同时可以人工对任务记录进行派发、移交，主要使用的业务场景有:

* 查询管理人员的任务列表
* 手动分配任务
* 任务移交
* 执行人排班
* 任务执行情况看板
* 手动取消任务
* 手动创建任务
* 评价任务结果
* 查看任务薪资明细

#### 运营商

任务派发人，对于两轮业务来说，就是车辆资产的所有人，主要的业务场景有:

* 确定任务类型、场景、派发时间、派发规则、派单量
* 任务执行情况看板
* 支付任务金额
* 个人账户查看
* 银行流水
* 账户充值
* 工资发放明细对账

#### 政府监管人员

政府监管人员主要是城市车辆管理锁，市政人员，城管人员等，主要的业务场景有:

* 城管收车
* 市场份额调整
* 车辆批量暂停、回收

#### 平台售后

* 任务模版创建
* 任务流程定义
  * 状态定义
  * 驱动事件定义
  * 行为定义
* 业务规则编写
* 规则组定义
* 数据源管理
* 灰度城市管理
* 平台数据监控
* 平台规则有效性校验

#### 用例图

![](http://www.ranjia.online/blog/img/任务用例图分析.png)

## 领域梳理




## 确定上下文

## 事件风暴

## 系统架构

## 测试驱动



